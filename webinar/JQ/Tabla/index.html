<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Ejercicio Práctico 7.2</title>
    <link rel="stylesheet" href="css/estiloTabla.css">
    <script src="https://code.jquery.com/jquery-3.7.1.js"
    integrity="sha256-eKhayi8LEQwp4NKxN+CfCh+3qOVUtJn3QNZ0TciWLP4=" crossorigin="anonymous"></script>

</head>

<body>

    <div class="container">
        <div class="data">
            <table>
                <caption>Precipitaciones anuales</caption>
                <thead>
                    <tr>
                        <th>Ciudad</th>
                        <th>2008</th>
                        <th>2009</th>
                        <th>2010</th>
                    </tr>
                </thead>
                <!--CUERPO-->
                <tbody>
                    <tr>
                        <td>Sevilla</td>
                        <td>50</td>
                        <td>100</td>
                        <td>75</td>
                    </tr>
                    <tr>
                        <td>Bilbao</td>
                        <td>250</td>
                        <td>300</td>
                        <td>180</td>
                    </tr>
                    <tr>
                        <td>Coruña</td>
                        <td>400</td>
                        <td>420</td>
                        <td>325</td>
                    </tr>
                    <tr>
                        <td>Zaragoza</td>
                        <td>100</td>
                        <td>150</td>
                        <td>60</td>
                    </tr>
                </tbody>
            </table>
            <p><button id="representar">Respresentar</button></p>
        </div>

        <!--GRAFICA-->
        <div class="graphics">
            <div>
                <div class="year-2008"></div>
                <div class="year-2009"></div>
                <div class="year-2010"></div>
                <div class="names">Sevilla</div>
            </div>
            <div>
                <div class="year-2008"></div>
                <div class="year-2009"></div>
                <div class="year-2010"></div>
                <div class="names">Bilbao</div>
            </div>
            <div>
                <div class="year-2008"></div>
                <div class="year-2009"></div>
                <div class="year-2010"></div>
                <div class="names">Coruña</div>
            </div>
            <div>
                <div class="year-2008"></div>
                <div class="year-2009"></div>
                <div class="year-2010"></div>
                <div class="names">Zaragoza</div>
            </div>
        </div>
    </div> 
    <script>
        $(function(){
            $("#representar").click(function(){
                $("tbody tr").each(function(index){
                    let cityIndex = index;

                    $(this).children(":gt(0)").each(function(indice){
                        let year_index = indice;
                        let value = parseInt($(this).text());
                        $(".graphics > div").eq(cityIndex).children().eq(year_index).animate({
                            "height": value
                        });
                    });
                });
            });

            //Para poder cambiar los valores. Tiene que ser delegado
            $("tbody").on("dblclick", "td", function (event) {
                $(this).replaceWith("<td><input type='number' value='" + parseInt($(this).text()) + "'></td>");
            });

            //Captura de los eventos delegados
            $("tbody").on("change", "input", function (event) {
                $(this).parent().html($(this).val());
                $("#representar").trigger("click");
            });
        });
    </script>
</body>
</html>